# 前端模块 - 部署环境变量配置指南

## 📋 概述

前端模块已将所有硬编码的本地地址替换为环境变量占位符，部署时需要配置以下环境变量。

---

## 🔧 需要配置的环境变量

### 1. 后端 API 地址

**变量名**: `VITE_API_BASE`

**说明**: 后端服务的基础 URL（部署在 Render 上的地址）

**示例值**: 
```
https://ai-career-helper-backend.onrender.com
```

**使用位置**:
- `src/utils/request.js` - API 请求基础地址
- `vite.config.js` - 开发环境代理配置
- `src/components/VirtualExperiment.vue` - 虚拟实验 API 调用
- `src/components/ResumeDoctor.vue` - 简历医生 API 调用

---

### 2. 简历医生服务地址

**变量名**: `VITE_RESUME_DOCTOR_URL`

**说明**: Streamlit 简历医生服务的完整 URL（部署在 Streamlit Cloud 上的地址）

**示例值**: 
```
https://ai-career-resume-doctor.streamlit.app
```

**使用位置**:
- `src/App.vue` - 跳转到简历医生页面
- `src/components/ResumeDoctor.vue` - iframe 嵌入简历医生

---

### 3. 用户持久化服务（可选）

**变量名**: `VITE_USER_SERVER`

**说明**: 如果使用独立的用户持久化服务，配置此变量。否则默认使用后端 API。

**示例值**: 
```
https://your-user-server.onrender.com
```

**使用位置**:
- `src/components/Login.vue` - 用户登录/注册服务

**注意**: 如果不配置此变量，将默认使用 `VITE_API_BASE` 的值。

---

## 🚀 在 Vercel 中配置环境变量

### 步骤一：进入项目设置

1. 登录 [Vercel Dashboard](https://vercel.com/dashboard)
2. 选择你的前端项目 `ai-career-helper-frontend`
3. 点击 **Settings**（设置）
4. 在左侧菜单选择 **Environment Variables**（环境变量）

### 步骤二：添加环境变量

点击 **Add New**（添加新变量），依次添加：

#### 1. 后端 API 地址
- **Name**: `VITE_API_BASE`
- **Value**: `https://your-backend.onrender.com`（替换为你的实际后端地址）
- **Environment**: 选择 `Production`、`Preview`、`Development`（全选）

#### 2. 简历医生地址
- **Name**: `VITE_RESUME_DOCTOR_URL`
- **Value**: `https://your-resume-doctor.streamlit.app`（替换为你的实际 Streamlit 地址）
- **Environment**: 选择 `Production`、`Preview`、`Development`（全选）

#### 3. 用户服务（可选）
- **Name**: `VITE_USER_SERVER`
- **Value**: `https://your-user-server.onrender.com`（如果需要）
- **Environment**: 选择 `Production`、`Preview`、`Development`（全选）

### 步骤三：重新部署

配置完环境变量后：

1. 点击 **Deployments**（部署）标签页
2. 找到最新的部署记录
3. 点击右侧的 **⋯**（三个点）菜单
4. 选择 **Redeploy**（重新部署）

或者：

1. 在项目根目录执行：
```bash
git commit --allow-empty -m "触发重新部署以应用环境变量"
git push
```

---

## 🔍 验证配置

部署完成后，检查以下内容：

### 1. 检查浏览器控制台

打开浏览器开发者工具（F12），查看 Console 输出：

```javascript
[request] API_BASE -> https://your-backend.onrender.com
[ResumeDoctor] resumeDoctorUrl -> https://your-resume-doctor.streamlit.app
```

### 2. 测试 API 连接

1. 打开前端页面
2. 尝试登录或调用任何 API
3. 检查 Network 标签页，确认请求地址正确

### 3. 测试简历医生

1. 点击"简历医生"功能
2. 确认 iframe 能正常加载 Streamlit 应用

---

## 📝 占位符说明

代码中使用的占位符：

- `{{RENDER_BACKEND_URL}}` - 后端服务占位符
- `{{STREAMLIT_RESUME_DOCTOR_URL}}` - 简历医生服务占位符

**注意**: 这些占位符在开发环境会显示，但在生产环境会被环境变量替换。

---

## 🛠️ 本地开发配置

### 方式一：使用 `.env` 文件（推荐）

在项目根目录创建 `.env` 文件：

```env
VITE_API_BASE=http://localhost:8000
VITE_RESUME_DOCTOR_URL=http://localhost:8501
VITE_USER_SERVER=http://localhost:3000
```

**注意**: `.env` 文件不要提交到 Git，已添加到 `.gitignore`

### 方式二：使用 `.env.local` 文件

创建 `.env.local` 文件（优先级更高，不会被 Git 跟踪）：

```env
VITE_API_BASE=http://localhost:8000
VITE_RESUME_DOCTOR_URL=http://localhost:8501
```

### 方式三：命令行设置（临时）

```bash
# Windows PowerShell
$env:VITE_API_BASE="http://localhost:8000"
$env:VITE_RESUME_DOCTOR_URL="http://localhost:8501"
npm run dev

# Linux/Mac
export VITE_API_BASE=http://localhost:8000
export VITE_RESUME_DOCTOR_URL=http://localhost:8501
npm run dev
```

---

## ⚠️ 注意事项

1. **环境变量前缀**: Vite 要求环境变量必须以 `VITE_` 开头才能在前端代码中访问

2. **重新构建**: 修改环境变量后，需要重新构建项目才能生效：
   ```bash
   npm run build
   ```

3. **开发环境代理**: `vite.config.js` 中的代理配置在开发环境有效，生产环境需要配置正确的 `VITE_API_BASE`

4. **CORS 配置**: 确保后端服务已配置 CORS，允许前端域名访问

5. **HTTPS**: 生产环境必须使用 HTTPS，确保所有服务地址都是 `https://` 开头

---

## 🆘 常见问题

### Q: 部署后 API 请求失败？

**A**: 检查以下几点：
1. 环境变量 `VITE_API_BASE` 是否正确配置
2. 后端服务是否正常运行
3. 后端 CORS 配置是否允许前端域名
4. 浏览器控制台是否有错误信息

### Q: 简历医生 iframe 无法加载？

**A**: 检查以下几点：
1. 环境变量 `VITE_RESUME_DOCTOR_URL` 是否正确配置
2. Streamlit 应用是否正常运行
3. Streamlit 是否允许 iframe 嵌入（检查 `.streamlit/config.toml`）

### Q: 本地开发时如何测试？

**A**: 
1. 创建 `.env.local` 文件
2. 配置本地服务地址
3. 运行 `npm run dev`
4. 确保后端和简历医生服务都在本地运行

---

## 📚 相关文档

- [Vercel 环境变量文档](https://vercel.com/docs/concepts/projects/environment-variables)
- [Vite 环境变量文档](https://vitejs.dev/guide/env-and-mode.html)
- [前端模块 README](./README.md)

---

## ✅ 配置检查清单

部署前请确认：

- [ ] `VITE_API_BASE` 已配置为后端服务地址
- [ ] `VITE_RESUME_DOCTOR_URL` 已配置为 Streamlit 服务地址
- [ ] 所有环境变量都选择了正确的环境（Production/Preview/Development）
- [ ] 已重新部署项目以应用环境变量
- [ ] 浏览器控制台无错误信息
- [ ] API 请求能正常响应
- [ ] 简历医生 iframe 能正常加载

---

**配置完成后，你的前端应用就可以正常连接到后端和简历医生服务了！** 🎉
