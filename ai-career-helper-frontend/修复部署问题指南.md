# 🔧 修复部署问题指南

## 问题诊断

从浏览器控制台错误可以看到：
```
POST https://www.aicareerhelper.xyz/%7B%7BRENDER BACKEND URL%7D%7D/ap... 405
```

这说明前端代码中的 `{{RENDER_BACKEND_URL}}` 占位符没有被环境变量替换，导致请求失败。

## ✅ 解决方案

### 第一步：确认 Render 后端地址

1. 登录 [Render Dashboard](https://dashboard.render.com)
2. 找到你的后端服务 `AI_Career_Helper-backend`
3. 复制服务 URL（格式类似：`https://ai-career-helper-backend-xxxxx.onrender.com`）
4. **重要**：确认服务状态是 **Live**（绿色）

### 第二步：在 Vercel 配置环境变量

1. 登录 [Vercel Dashboard](https://vercel.com)
2. 进入你的项目 `ai-career-helper`
3. 点击 **Settings** → **Environment Variables**
4. 添加以下环境变量：

| 变量名 | 值 | 环境 |
|--------|-----|------|
| `VITE_API_BASE` | `https://ai-career-helper-backend-xxxxx.onrender.com` | Production, Preview, Development |

**注意**：
- 把 `xxxxx` 替换成你实际的 Render 服务 ID
- 确保 URL 以 `https://` 开头，末尾**不要**有斜杠 `/`
- 三个环境（Production、Preview、Development）都要添加

### 第三步：重新部署前端

配置完环境变量后：

1. 在 Vercel 项目页面，点击 **Deployments**
2. 找到最新的部署记录，点击右侧 **⋯** → **Redeploy**
3. 或者直接 push 一个空 commit 触发自动部署：
   ```bash
   git commit --allow-empty -m "触发重新部署以应用环境变量"
   git push
   ```

### 第四步：验证修复

部署完成后：

1. 打开前端网站：`https://www.aicareerhelper.xyz`
2. 按 `F12` 打开开发者工具 → **Console** 标签
3. 刷新页面，查看日志：
   - 应该看到：`[VirtualExperiment] API_BASE -> https://ai-career-helper-backend-xxxxx.onrender.com`
   - **不应该**看到 `{{RENDER_BACKEND_URL}}` 这样的占位符
4. 测试「虚拟职业体验」功能：
   - 选择一个职业或搜索职业
   - 查看 Network 标签，确认请求地址是 `https://ai-career-helper-backend-xxxxx.onrender.com/api/...`

## 🔍 后端接口验证

### 检查后端是否正常运行

1. 访问后端根路径：`https://ai-career-helper-backend-xxxxx.onrender.com`
   - 应该返回 JSON 或正常响应（不是 404）

2. 测试新接口：`https://ai-career-helper-backend-xxxxx.onrender.com/api/generate-job-test`
   - 使用 Postman 或 curl 发送 POST 请求：
     ```bash
     curl -X POST https://ai-career-helper-backend-xxxxx.onrender.com/api/generate-job-test \
       -H "Content-Type: application/json" \
       -d '{"jobName": "律师"}'
     ```
   - 应该返回包含 `script` 和 `testQuestions` 的 JSON

### 如果后端 /docs 返回 404

FastAPI 默认提供 `/docs`，但如果返回 404，可能是：
- Render 部署配置问题
- 路由被覆盖

**不影响功能**，只要 `/api/*` 接口能正常访问即可。

## 📝 代码修复说明

我已经修复了以下文件中的占位符问题：

1. ✅ `src/components/VirtualExperiment.vue` - 移除了 `{{RENDER_BACKEND_URL}}` 占位符
2. ✅ `src/components/Login.vue` - 修复了 `SERVER_API` 的默认值
3. ✅ `vite.config.js` - 开发环境代理改为 `http://localhost:8000`

**下一步**：提交这些修改并 push 到 Git，然后按照上面的步骤配置 Vercel 环境变量。

## ⚠️ 常见问题

### Q: 配置环境变量后还是不行？

**A**: 检查以下几点：
1. 环境变量名称必须是 `VITE_API_BASE`（注意 `VITE_` 前缀）
2. 值必须是完整的 URL，包括 `https://`
3. 三个环境（Production、Preview、Development）都要配置
4. 配置后必须重新部署才能生效

### Q: 如何确认环境变量已生效？

**A**: 
1. 在浏览器控制台查看 `console.debug` 输出的 `API_BASE` 值
2. 在 Network 标签查看实际请求的 URL
3. 如果看到占位符或空字符串，说明环境变量未生效

### Q: 后端接口返回 500 错误？

**A**: 
1. 检查 Render 后端日志（Render Dashboard → Logs）
2. 确认 `DEEPSEEK_API_KEY` 环境变量已配置
3. 检查后端服务是否正常运行（状态为 Live）

---

**完成以上步骤后，你的功能应该就能正常工作了！** 🎉
